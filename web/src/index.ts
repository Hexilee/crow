import * as THREE from 'three'
import Stats from 'stats.js'
import { OrbitControls, MapControls } from 'three/examples/jsm/controls/OrbitControls'
import { TransformControls } from 'three/examples/jsm/controls/TransformControls'

const camera = new THREE.PerspectiveCamera(36, window.innerWidth / window.innerHeight, 0.25, 16)
const scene = new THREE.Scene()
const renderer = new THREE.WebGLRenderer()
const render = () => {
    renderer.render(scene, camera)
}
const stats = new Stats()
// Geometry
const material = new THREE.MeshPhongMaterial({
    color: 0x80ee10,
    shininess: 100,
    side: THREE.DoubleSide,
})

const curve = new THREE.CatmullRomCurve3([
    new THREE.Vector3(0.00018260864482227135, 0.00000000000000006106266433463493, 0.0000000000000001665334536937734),
    new THREE.Vector3(0.0003652166809032055, -0.0000000000000002810480545925672, -0.1999994442351644),
    new THREE.Vector3(0.001095645780213021, -0.000000000000000017242641747955578, -0.3999972211849398),
    new THREE.Vector3(0.0027390925294722016, 0.000000000000000041908329406553726, -0.5999891071113429),
    new THREE.Vector3(0.005660696886957511, 0.00000000000000014153334330784545, -0.7999658767493518),
    new THREE.Vector3(0.010225456332411906, -0.00000000000000027813330529794314, -0.9999113036114087),
    new THREE.Vector3(0.01679807610511823, 0.0000000000000001462991540225826, -1.1998001621764294),
    new THREE.Vector3(0.02574273731328757, -0.00000000000000006769126780785192, -1.3995962338974006),
    new THREE.Vector3(0.03742276476203404, -0.00000000000000033444725983231257, -1.5992503200107269),
    new THREE.Vector3(0.052200176460499216, -0.000000000000000020090357675999488, -1.7986982654108676),
    new THREE.Vector3(0.07043509695268417, 0.0000000000000006336722200012097, -1.997858999362816),
    new THREE.Vector3(0.09248501689533477, -0.0000000000000005101985289676351, -2.1966326005591883),
    new THREE.Vector3(0.1187038817085787, -0.000000000000000705423164725594, -2.3948983959822825),
    new THREE.Vector3(0.14944099268264907, 0.00000000000000022433804492130676, -2.592513105196396),
    new THREE.Vector3(0.1850397046720754, -0.0000000000000004528459870761704, -2.789309044060617),
    new THREE.Vector3(0.22583590548555552, -0.0000000000000013256035770026349, -2.9850924044023825),
    new THREE.Vector3(0.2721562633259601, 0.0000000000000008250858713702635, -3.179641628907487),
    new THREE.Vector3(0.32431623019397837, 0.00000000000000012935696889926725, -3.372705903338062),
    new THREE.Vector3(0.38261779108524346, -0.00000000000000037609798407986446, -3.564003791155296),
    new THREE.Vector3(0.447346951130169, -0.0000000000000014525218743018199, -3.7532220386598363),
    new THREE.Vector3(0.5187709555937094, 0.00000000000000017448514898551365, -3.940014581824219),
    new THREE.Vector3(0.5971352409134089, 0.00000000000000027475030330807955, -4.124001789023214),
    new THREE.Vector3(0.6825441430217388, -0.00000000000000043226212915414025, -4.304829651758047),
    new THREE.Vector3(0.7754238827179571, 0.0000000000000002813884575383895, -4.481935818824643),
    new THREE.Vector3(0.8757029283748611, -0.00000000000000008880067965362804, -4.654959503925255),
    new THREE.Vector3(0.9832901463052878, 0.0000000000000019102783420970308, -4.823535639461691),
    new THREE.Vector3(1.0980740684864425, 0.00000000000000011265565867763615, -4.987295868638511),
    new THREE.Vector3(1.2199221974564607, 0.0000000000000003658950643136284, -5.145869610541002),
    new THREE.Vector3(1.348680354305948, -0.0000000000000002317800615338045, -5.298885198271492),
    new THREE.Vector3(1.4841720759108838, 0.0000000000000014590082826078554, -5.445971089831087),
    new THREE.Vector3(1.6261980677577197, -0.0000000000000010703912901091231, -5.586757151005797),
    new THREE.Vector3(1.7745357188937254, -0.00000000000000009864701916530904, -5.7208760090560835),
    new THREE.Vector3(1.9289386856921062, -0.0000000000000006244334038834663, -5.8479644755174425),
    new THREE.Vector3(2.0891365512490485, -0.0000000000000007043632618450407, -5.967665035897667),
    new THREE.Vector3(2.2548345673244627, -0.0000000000000004042103890480291, -6.0796274035041264),
    new THREE.Vector3(2.4257134857969955, 0.00000000000000002855847974339659, -6.183510134053618),
    new THREE.Vector3(2.6014294866222505, -0.0000000000000022243361263277855, -6.278982297109157),
    new THREE.Vector3(2.781614209257987, -0.00000000000000037181021449499357, -6.365725199754669),
    new THREE.Vector3(2.9658748944472597, 0.000000000000002081337216365679, -6.4434341572618266),
    new THREE.Vector3(3.153794643126202, -0.0000000000000005639104640698743, -6.511820304826483),
    new THREE.Vector3(3.3449327990439914, -0.0000000000000005049769828184522, -6.570612443757845),
    new THREE.Vector3(3.53882546144438, 0.0000000000000017108069469765896, -6.619558914795464),
    new THREE.Vector3(3.7349861338579036, -0.0000000000000016403596792180355, -6.658429490511568),
    new THREE.Vector3(3.932906514687834, -0.0000000000000008816079496740567, -6.687017278033042),
    new THREE.Vector3(4.132057434838152, -0.0000000000000005441572136113784, -6.7051406225941195),
    new THREE.Vector3(4.331891357490179, -0.00000000000000038844705764206346, -6.71283345160167),
    new THREE.Vector3(4.531848098577723, -0.000000000000000011034226230881626, -6.709593001854523),
    new THREE.Vector3(4.731349011422706, -0.0000000000000011197690217836932, -6.69570074600411),
    new THREE.Vector3(4.929860253296436, 0.0000000000000015051358703117207, -6.67146660390653),
    new THREE.Vector3(5.126892898973302, -0.0000000000000012702696134780752, -6.637224396868166),
    new THREE.Vector3(5.322002693885104, 0.00000000000000020920233069433097, -6.593327550018439),
    new THREE.Vector3(5.514789489290073, -0.0000000000000005749074127072983, -6.540145058571402),
    new THREE.Vector3(5.704896400396317, 0.00000000000000177255464698167, -6.47805772902491),
    new THREE.Vector3(5.892008726575351, 0.000000000000002534166116998658, -6.407454702105434),
    new THREE.Vector3(6.075852670736978, -0.0000000000000032935961331154732, -6.328730260492895),
    new THREE.Vector3(6.256193892675475, 0.000000000000001291573863731827, -6.242280921041923),
    new THREE.Vector3(6.432835928795531, -0.0000000000000003147174618545353, -6.14850280833672),
    new THREE.Vector3(6.605618508135756, -0.0000000000000005853477994217503, -6.047789303955609),
    new THREE.Vector3(6.7744157920726815, 0.0000000000000008384212472070919, -5.940528963753988),
    new THREE.Vector3(6.939134562546746, -0.00000000000000017290648170013202, -5.827103693774262),
    new THREE.Vector3(7.099712381138515, 0.0000000000000008503320331587125, -5.707887174030525),
    new THREE.Vector3(7.256115738864641, 0.00000000000000041731694542524686, -5.583243518365012),
    new THREE.Vector3(7.4083382141823755, -0.000000000000001325326361586268, -5.453526157803603),
    new THREE.Vector3(7.556398654407006, -0.00000000000000030808096389014286, -5.319076934319328),
    new THREE.Vector3(7.700339393572713, 0.000000000000000168484843021966, -5.180225391618121),
    new THREE.Vector3(7.840224517713838, 0.0000000000000003057042187519112, -5.0372882494613505),
    new THREE.Vector3(7.976138186618435, -0.00000000000000012408702252056297, -4.890569048109175),
    new THREE.Vector3(8.10818301931287, -0.0000000000000007013941296436527, -4.74035794968252),
    new THREE.Vector3(8.236478548876702, -0.0000000000000002991898919613728, -4.58693168357478),
    new THREE.Vector3(8.361159750661638, -0.0000000000000004002815757807078, -4.430553623477091),
    new THREE.Vector3(8.482375646593237, -0.0000000000000003162291464733305, -4.271473984091021),
    new THREE.Vector3(8.600287986966938, 0.000000000000000450479993843162, -4.109930126172625),
    new THREE.Vector3(8.715022922797633, -0.00000000000000042333089103662205, -3.9461150524193944),
    new THREE.Vector3(8.826857671686732, -0.0000000000000002200662994772261, -3.7803063048508507),
    new THREE.Vector3(8.935890781339006, 0.0000000000000003280790338439577, -3.612641769052052),
    new THREE.Vector3(9.042226014489497, 0.0000000000000002239913595229351, -3.4432531824032697),
    new THREE.Vector3(9.145971935405301, 0.0000000000000005096844074732724, -3.2722662989426543),
    new THREE.Vector3(9.247241518195874, -0.0000000000000007605181275571096, -3.099801075940749),
    new THREE.Vector3(9.346151776516384, -0.0000000000000004940565043184296, -2.925971880293701),
    new THREE.Vector3(9.442823414126458, 0.0000000000000006110876699369394, -2.7508877129512745),
    new THREE.Vector3(9.537380495655468, 0.0000000000000001007945268759637, -2.57465244970348),
    new THREE.Vector3(9.629950136825254, -0.00000000000000016975784031830243, -2.3973650967554536),
    new THREE.Vector3(9.720662213291474, 0.00000000000000026255134652949233, -2.2191200596229987),
    new THREE.Vector3(9.809649087183661, -0.0000000000000004489486587963428, -2.0400074239804415),
    new THREE.Vector3(9.897045350352803, -0.00000000000000020803886209672775, -1.860113247187555),
    new THREE.Vector3(9.982987583270692, -0.00000000000000018931441470388383, -1.6795198593123981),
    new THREE.Vector3(10.06761412846977, 0.00000000000000000759690514242754, -1.4983061725520792),
    new THREE.Vector3(10.151064877361955, -0.00000000000000019996215720252268, -1.3165479980326613),
    new THREE.Vector3(10.233481069232536, 0.0000000000000000990784462760446, -1.1343183690427552),
    new THREE.Vector3(10.315005101167154, 0.00000000000000017342876199708009, -0.9516878698221201),
    new THREE.Vector3(10.395780347638489, 0.00000000000000010100430881223957, -0.7687249690869635),
    new THREE.Vector3(10.475950988451745, -0.000000000000000137382412259258, -0.5854963575267834),
    new THREE.Vector3(10.555661843725556, -0.000000000000000005023486516703817, -0.40206728855395935),
    new THREE.Vector3(10.635058214566733, -0.00000000000000016994658464041445, -0.21850192162622775),
    new THREE.Vector3(10.714285728082437, -0.0000000000000001655684508002837, -0.03486366749371079),
    new THREE.Vector3(10.793490185362419, 0.000000000000000018696276869117796, 0.14878446525392108),
    new THREE.Vector3(10.872804511120842, 0.0000000000000001155617563353864, 0.3323851069797656),
    new THREE.Vector3(10.952400216362385, 0.000000000000000020353771525136844, 0.5158638737387872),
    new THREE.Vector3(11.032396935661968, 0.00000000000000013957682338979874, 0.6991680810809588),
    new THREE.Vector3(11.112913959101823, -0.000000000000000018033162990914798, 0.8822442592151966),
    new THREE.Vector3(11.194070125059552, 0.00000000000000021039017685907854, 1.065037920152324),
    new THREE.Vector3(11.2759837096758, -0.00000000000000027383289663917637, 1.2474933263399246),
    new THREE.Vector3(11.35877231225071, 0.00000000000000015573149860953426, 1.4295532611624489),
    new THREE.Vector3(11.442552735827563, 0.00000000000000001617193796119093, 1.6111588016985787),
    new THREE.Vector3(11.527440862232007, -0.00000000000000010936726391746359, 1.7922490941497742),
    new THREE.Vector3(11.613551520848391, 0.0000000000000006523010560873102, 1.9727611323790872),
    new THREE.Vector3(11.700998350428732, 0.000000000000000036917152844354227, 2.1526295400278035),
    new THREE.Vector3(11.789893653247493, -0.00000000000000014309803883383916, 2.331786356709066),
    new THREE.Vector3(11.880348240934417, -0.0000000000000006108717661163747, 2.510160828812102),
    new THREE.Vector3(11.97247127134018, 0.000000000000000259080970012433, 2.6876792054883127),
    new THREE.Vector3(12.066370075814358, 0.00000000000000023410856231417473, 2.8642645404306077),
    new THREE.Vector3(12.162149976303914, -0.000000000000000367259771902834, 3.039836500100329),
    new THREE.Vector3(12.259914091711801, -0.0000000000000000024350102796913287, 3.2143111791013363),
    new THREE.Vector3(12.359763132990636, 0.00000000000000024628073013667695, 3.3876009234484408),
    new THREE.Vector3(12.461795186485686, -0.00000000000000007791468430393632, 3.5596141625268323),
    new THREE.Vector3(12.566105485084913, -0.00000000000000003026450606318551, 3.730255250590539),
    new THREE.Vector3(12.672786166781421, -0.0000000000000002775927678188187, 3.8994243187007283),
    new THREE.Vector3(12.78192602030696, -0.0000000000000011697252151789685, 4.067017138058594),
    new THREE.Vector3(12.893610217552526, 0.000000000000000049751991369162296, 4.23292499574252),
    new THREE.Vector3(13.007920032554749, -0.0000000000000009467116855589003, 4.397034583914325),
    new THREE.Vector3(13.12493254689725, 0.00000000000000003792548771260245, 4.5592279036149534),
    new THREE.Vector3(13.244661271760977, 0.0000000000000005253698468196989, 4.719427730446014),
    new THREE.Vector3(13.36729295218696, -0.0000000000000007502875598661752, 4.877416444971692),
    new THREE.Vector3(13.492772388052893, 0.00000000000000013863806807561718, 5.033153033373162),
    new THREE.Vector3(13.621044064293518, -0.000000000000001247878247973313, 5.18659801256882),
    new THREE.Vector3(13.752052189463718, 0.00000000000000043060579319931467, 5.337713420195917),
    new THREE.Vector3(13.88574073355192, -0.000000000000000689821040479712, 5.486462803800219),
    new THREE.Vector3(14.022053465034997, 0.000000000000001092026889586107, 5.632811209264992),
    new THREE.Vector3(14.160933987166498, 0.000000000000000014816285908333452, 5.776725168509798),
    new THREE.Vector3(14.302325773491216, -0.0000000000000009196112576521213, 5.918172686489807),
    new THREE.Vector3(14.44617220258001, 0.0000000000000018856144248892683, 6.057123227525714),
    new THREE.Vector3(14.592416591979486, -0.0000000000000002304091254639783, 6.193547700994029),
    new THREE.Vector3(14.741002231372304, -0.0000000000000018458504304246124, 6.327418446407393),
    new THREE.Vector3(14.891872414944482, -0.0000000000000022193077384712686, 6.458709217913839),
    new THREE.Vector3(15.044970472957178, -0.0000000000000007332879946278802, 6.587395168243962),
    new THREE.Vector3(15.200239802520828, 0.0000000000000009591748277544276, 6.7134528321340685),
    new THREE.Vector3(15.35762389757078, -0.0000000000000002636500342622739, 6.836860109253543),
    new THREE.Vector3(15.517066378043841, 0.0000000000000005311286052210446, 6.9575962466635595),
    new THREE.Vector3(15.678511018256168, 0.00000000000000029471507324272466, 7.07564182083452),
    new THREE.Vector3(15.841901774483745, -0.0000000000000022360399796309744, 7.190978719248556),
    new THREE.Vector3(16.007182811746826, -0.0000000000000006149806313162497, 7.3035901216134365),
    new THREE.Vector3(16.17429852980098, -0.00000000000000025098508639967557, 7.413460480713309),
    new THREE.Vector3(16.343193588337748, -0.000000000000002067038282735286, 7.520575502921625),
    new THREE.Vector3(16.513812931398423, 0.0000000000000006278465007868263, 7.624922128400914),
    new THREE.Vector3(16.686101811005148, 0.0000000000000012456141985652866, 7.726488511013358),
    new THREE.Vector3(16.86000581001403, 0.0000000000000010491663885937607, 7.8252639979661645),
    new THREE.Vector3(17.035470864195798, -0.0000000000000005575489713453067, 7.921239109214735),
])

const geometry = new THREE.TubeGeometry(
    curve,  //path
    64,
    0.1,
)

const object = new THREE.Mesh(geometry, material)
object.castShadow = true
const controls = new MapControls(camera, renderer.domElement)
controls.update()
controls.enableDamping = true // an animation loop is required when either damping or auto-rotation are enabled
controls.dampingFactor = 0.05
controls.screenSpacePanning = false
controls.maxPolarAngle = Math.PI / 8

// let hiding = 0;
const transformControl = new TransformControls(camera, renderer.domElement)
transformControl.addEventListener('change', render)
transformControl.addEventListener('dragging-changed', (event) => {
    controls.enabled = !event.value
})
transformControl.attach(object)
transformControl.setMode('translate')
scene.add(transformControl)

const init = () => {
    camera.position.set(0, 1.3, 3)
    // Lights
    scene.add(new THREE.AmbientLight(0x505050))
    let spotLight = new THREE.SpotLight(0xffffff)
    spotLight.angle = Math.PI / 5
    spotLight.penumbra = 0.2
    spotLight.position.set(2, 3, 3)
    spotLight.castShadow = true
    spotLight.shadow.camera.near = 3
    spotLight.shadow.camera.far = 10
    spotLight.shadow.mapSize.width = 1024
    spotLight.shadow.mapSize.height = 1024
    scene.add(spotLight)
    let dirLight = new THREE.DirectionalLight(0x55505a, 1)
    dirLight.position.set(0, 3, 0)
    dirLight.castShadow = true
    dirLight.shadow.camera.near = 1
    dirLight.shadow.camera.far = 10
    dirLight.shadow.camera.right = 1
    dirLight.shadow.camera.left = -1
    dirLight.shadow.camera.top = 1
    dirLight.shadow.camera.bottom = -1
    dirLight.shadow.mapSize.width = 1024
    dirLight.shadow.mapSize.height = 1024
    scene.add(dirLight)
    scene.add(object)

    document.body.appendChild(stats.dom)
    renderer.shadowMap.enabled = true
    renderer.setPixelRatio(window.devicePixelRatio)
    renderer.setSize(window.innerWidth, window.innerHeight)
    window.addEventListener('resize', onWindowResize, false)
    document.body.appendChild(renderer.domElement)
}

const onWindowResize = () => {
    camera.aspect = window.innerWidth / window.innerHeight
    camera.updateProjectionMatrix()
    renderer.setSize(window.innerWidth, window.innerHeight)
    render()
}

init()
render()
const animate = () => {
    requestAnimationFrame(animate)
    stats.begin()
    renderer.render(scene, camera)
    stats.end()
}
animate()
